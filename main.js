(()=>{"use strict";function t(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function e(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}var n=function(t){var n=document.querySelector(".popup_is-opened");"Escape"===t.key&&e(n)},o="https://mesto.nomoreparties.co/v1/wff-cohort-33",r="dd20b3a2-cbfb-4a98-bf25-02ef0e1d0d29",c="application/json",a=function(t){return 200===t.status?t.json():Promise.reject("Что-то пошло не так: ".concat(t.status))};function u(t,e,n,o,r,c,a,u,i,l){var s=document.querySelector("#card-template").content.cloneNode(!0),d=s.querySelector(".places__item"),p=s.querySelector(".card__image"),f=s.querySelector(".amount__likes");f.textContent=c,p.alt=t,p.src=e,s.querySelector(".card__title").textContent=t;var _=s.querySelector(".card__delete-button");a?_.addEventListener("click",(function(){return r(u,d)})):_.setAttribute("style","display: none;"),p.addEventListener("click",(function(){return n(p.src,p.alt,p.alt)}));var y=s.querySelector(".card__like-button");return l&&y.classList.add("card__like-button_is-active"),y.addEventListener("click",(function(){return o(u,y,f,i)})),s}function i(t,e){!function(t){fetch("".concat(o,"/cards/").concat(t),{method:"DELETE",headers:{authorization:"".concat(r)}}).then(a)}(t),e.remove()}function l(t,e,n){e.classList.contains("card__like-button_is-active")?function(t){return fetch("".concat(o,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:"".concat(r)}}).then(a)}(t).then((function(t){var o=t.likes.length;n.textContent=o,e.classList.remove("card__like-button_is-active")})).catch((function(t){alert(t)})):function(t){return fetch("".concat(o,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:"".concat(r)}}).then(a)}(t).then((function(t){var o=t.likes.length;n.textContent=o,e.classList.add("card__like-button_is-active")})).catch((function(t){alert(t)}))}function s(t,e,n,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?p(t,e,n):d(t,e,e.validationMessage,n),!0===o&&p(t,e,n)}var d=function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)};function p(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function f(t,e,n){var o=t.querySelector(n.submitButtonSelector);!0===e.some((function(t){return t.validity.patternMismatch||!t.validity.valid}))?(o.setAttribute("disabled",!0),o.classList.add(n.inactiveButtonClass)):(o.removeAttribute("disabled",!0),o.classList.remove(n.inactiveButtonClass))}function _(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"false",o=Array.from(t.querySelectorAll(e.inputSelector));f(t,o,e),o.forEach((function(o){s(t,o,e,n)}))}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var m,v=document.querySelector(".profile__image"),h=document.querySelector(".profile__image"),S=document.querySelector(".profile__title"),b=document.querySelector(".profile__description"),q=document.querySelector(".popup__input_type_name"),C=document.querySelector(".popup__input_type_description"),E=document.querySelector(".places__list"),L=document.querySelector(".popup__input_type_card-name"),k=document.querySelector(".popup__input_type_url"),g=document.querySelector(".profile__edit-button"),x=document.querySelector(".popup_type_edit"),A=document.querySelector(".profile__add-button"),w=document.querySelector(".popup_type_new-card"),T=document.querySelector(".popup_type_new-avatar"),z=document.querySelector(".popup_type_image"),B=z.querySelector(".popup__image"),j=z.querySelector(".popup__caption"),O=document.querySelector(".popup_type_edit .popup__form"),P=document.querySelector(".popup_type_new-card .popup__form"),D=document.querySelector(".popup_type_new-avatar .popup__form"),M=(document.querySelector(".icon__edit"),document.querySelector(".popup_type_new-avatar .popup__input_type_url")),N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function I(e,n,o){B.src=e,B.alt=n,j.textContent=o,t(z)}function J(t){t.querySelector(".popup__close").addEventListener("click",(function(){e(t)})),t.addEventListener("mousedown",(function(n){n.target.classList.contains("popup")&&e(t)}))}Promise.all([fetch("".concat(o,"/cards"),{headers:{authorization:"".concat(r)}}).then(a),fetch("".concat(o,"/users/me"),{headers:{authorization:"".concat(r)}}).then(a)]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(e,n)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1],a=c._id;r.forEach((function(t){var e=!1;t.owner._id===a&&(e=!0);var n=!1;t.likes.some((function(t){return t._id===a}))&&(n=!0);var o=u(t.name,t.link,I,l,i,t.likes.length,e,t._id,a,n);E.append(o)})),S.textContent=c.name,b.textContent=c.about,v.setAttribute("style","background-image: url(".concat(c.avatar,")"))})).catch((function(t){alert(t)})),g.addEventListener("click",(function(){q.value=S.textContent,C.value=b.textContent,t(x),_(O,N)})),O.addEventListener("submit",(function(t){t.preventDefault();var n=x.querySelector("".concat(N.submitButtonSelector));n.textContent="Сохранение...",function(t,e){return fetch("".concat(o,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(r),"Content-Type":"".concat(c)},body:JSON.stringify({name:"".concat(t.value),about:"".concat(e.value)})}).then(a)}(q,C).then((function(t){S.textContent=t.name,b.textContent=t.about,e(x)})).catch((function(t){alert(t)})).finally((function(){n.textContent="Сохранить"}))})),A.addEventListener("click",(function(){t(w)})),P.addEventListener("submit",(function(t){t.preventDefault();var n=w.querySelector("".concat(N.submitButtonSelector));n.textContent="Сохранение...",function(t,e){return fetch("".concat(o,"/cards"),{method:"POST",headers:{authorization:"".concat(r),"Content-Type":"".concat(c)},body:JSON.stringify({name:"".concat(t.value),link:"".concat(e.value)})}).then(a)}(L,k).then((function(t){var o=t._id,r=t.owner._id,c=t.likes.length;E.prepend(u(L.value,k.value,I,l,i,c,!0,o,r,!1)),n.textContent="Сохранить",e(w),P.reset(),_(P,N,!0)})).catch((function(t){alert(t)})).finally((function(){n.textContent="Сохранить"}))})),J(x),J(w),J(z),J(T),m=N,Array.from(document.querySelectorAll(m.formSelector)).forEach((function(t){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));n.forEach((function(o){o.addEventListener("input",(function(){s(t,o,e),f(t,n,e)}))}))}(t,m)})),h.addEventListener("click",(function(){t(T)})),D.addEventListener("submit",(function(t){t.preventDefault();var n=T.querySelector("".concat(N.submitButtonSelector));n.textContent="Сохранение...",function(t){return fetch("".concat(o,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(r),"Content-Type":"".concat(c)},body:JSON.stringify({avatar:"".concat(t.value)})}).then(a)}(M).then((function(t){v.setAttribute("style","background-image: url(".concat(t.avatar,")")),n.textContent="Сохранить",e(T),D.reset(),_(D,N,!0)})).catch((function(t){alert(t)})).finally((function(){n.textContent="Сохранить"}))}))})();